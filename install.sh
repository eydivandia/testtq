#!/bin/bash

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ   ๐ ูุตุจ ุณุณุชู ูุฏุฑุช ูพุฑูฺู                    โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

# ุจุฑุฑุณ Docker
if ! command -v docker &> /dev/null; then
    echo "โ Docker ูุตุจ ูุณุช. ุฏุฑ ุญุงู ูุตุจ..."
    curl -fsSL https://get.docker.com -o get-docker.sh
    sudo sh get-docker.sh
    sudo usermod -aG docker $USER
    rm get-docker.sh
    echo "โ Docker ูุตุจ ุดุฏ"
fi

# ุจุฑุฑุณ Docker Compose
if ! command -v docker-compose &> /dev/null; then
    echo "โ Docker Compose ูุตุจ ูุณุช. ุฏุฑ ุญุงู ูุตุจ..."
    sudo apt update
    sudo apt install -y docker-compose
    echo "โ Docker Compose ูุตุจ ุดุฏ"
fi

# ุชููู ฺฉุงูุชูุฑูุง ูุจู
echo "๐งน ูพุงฺฉโุณุงุฒ ฺฉุงูุชูุฑูุง ูุจู..."
docker-compose down 2>/dev/null

# ุณุงุฎุช ู ุงุฌุฑุง
echo "๐๏ธ ุณุงุฎุช ู ุฑุงูโุงูุฏุงุฒ ุณุณุชู..."
docker-compose up -d --build

# ุตุจุฑ ุจุฑุง ุขูุงุฏู ุดุฏู
echo "โณ ุตุจุฑ ุจุฑุง ุขูุงุฏู ุดุฏู ุณุฑูุณโูุง (30 ุซุงูู)..."
sleep 30

# ุจุฑุฑุณ ูุถุนุช
echo "๐ ุจุฑุฑุณ ูุถุนุช..."
docker-compose ps

# ุชุณุช ุณุฑูุณโูุง
echo "๐งช ุชุณุช ุณุณุชู..."
if curl -f http://localhost:5000/health > /dev/null 2>&1; then
    echo "โ Backend ูุนุงู ุงุณุช"
else
    echo "โ๏ธ Backend ุฏุฑ ุญุงู ุขูุงุฏู ุดุฏู ุงุณุช..."
fi

if curl -f http://localhost:3000 > /dev/null 2>&1; then
    echo "โ Frontend ูุนุงู ุงุณุช"
else
    echo "โ๏ธ Frontend ุฏุฑ ุญุงู ุขูุงุฏู ุดุฏู ุงุณุช..."
fi

echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ   โ ุณุณุชู ุจุง ููููุช ูุตุจ ุดุฏ!                   โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ ุฏุณุชุฑุณ ุจู ุณุณุชู:"
echo "   ุขุฏุฑุณ: http://localhost:3000"
echo ""
echo "๐ ุงุทูุงุนุงุช ูุฑูุฏ:"
echo "   ูุงู ฺฉุงุฑุจุฑ: admin"
echo "   ุฑูุฒ ุนุจูุฑ: admin123"
echo ""
echo "๐ ุฏุณุชูุฑุงุช ููุฏ:"
echo "   ูุดุงูุฏู ูุงฺฏ: docker-compose logs -f"
echo "   ุฑโุงุณุชุงุฑุช: docker-compose restart"
echo "   ุชููู: docker-compose down"
echo ""
echo "โ๏ธ ุงฺฏุฑ ุตูุญู ุจุงุฒ ูุดุฏุ 1 ุฏููู ุตุจุฑ ฺฉูุฏ ู ุฏูุจุงุฑู ุงูุชุญุงู ฺฉูุฏ"
